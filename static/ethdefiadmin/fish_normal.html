<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>活跃的鱼</title>
<link rel="icon" href="favicon.ico" type="image/ico">

<link rel="stylesheet" href="./loading/css/animate.css">
<link rel="stylesheet" href="./loading/css/global.css">
<link rel="stylesheet" href="./loading/css/loading.css">


<link href="./css/bootstrap.min.css" rel="stylesheet">
<link href="./css/materialdesignicons.min.css" rel="stylesheet">
<link href="./js/jquery-confirm/jquery-confirm.min.css" rel="stylesheet">
<link href="./css/animate.min.css" rel="stylesheet">
<link href="./css/style.min.css" rel="stylesheet">


<link rel="stylesheet" href="./css/message.css" media="all" />
<!--时间选择插件-->
<link rel="stylesheet" href="./js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css">

</head>

<body>
<div class="container-fluid p-t-15">

  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          <div class="card-title">常规操作</div>
        </div>
        <div class="card-body">

<!-- ml-md-auto -->
        <form>

          <input id="uploadinput" type="file" style="display:none" accept=".xls,.excel,.xlsx,.txt">

        </form>
          <form>
            <div class="row">
<!--              <div class="col">-->
<!--                &lt;!&ndash; <input type="text" class="form-control" placeholder="请输入邮箱"> &ndash;&gt;-->
<!--                <div class="input-group">-->


<!--                  <div class="input-group-prepend">-->
<!--                    <button class="btn btn-default" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="search-btn">欲添加抖音链接地址:</button>-->
<!--                  </div>-->
<!--                  <input type="text" class="form-control" id="dyurl" style="width:365px">-->

<!--                </div>-->
<!--              </div>-->

                <div style="margin-left: 30px">
                    <select class="addselectpicker" data-style="btn btn-purple" id="agentlist">
                    </select>

                </div>
                <div style="margin-left: 30px">
                    <select class="agentsublist" data-style="btn btn-yellow" id="agentsublist">
                    </select>
                </div>
                <div style="margin-left: 30px">
                    <select class="authStatus" data-style="btn btn-pink" id="authStatus">
                        <option value="777777" selected>授权状态(全部)</option>
                        <option value="2">已授权</option>
                        <option value="1">未授权</option>
                    </select>
                </div>
<!--                <div style="margin-left: 30px;width: 350px">-->
<!--                    <input class="form-control js-datetimepicker" type="text" id="example-datetimepicker" name="add_time" placeholder="请选择具体时间" value="" data-side-by-side="true" data-locale="zh-cn" data-format="YYYY-MM-DD HH:mm:ss" />-->
<!--                </div>-->
              <div class="col">
                 <a class="btn btn-primary m-r-5" href="#!" id="querySelectBtn"><i class="mdi mdi-folder-search-outline"></i> 查询</a>
                <a class="btn btn-purple m-r-5" target-form="ids" id="reloadDataBtn"><i class="mdi mdi-reload"></i> 刷新数据</a>
              </div>
            </div>


<!--            <div class="row" style="margin-top:20px">-->

<!--              <div class="col">-->
<!--                <a class="btn btn-info m-r-5" href="#!" id="addUrlBtn"><i class="mdi mdi-plus"></i> 添加链接</a>-->
<!--                <a class="btn btn-cyan m-r-5" target-form="ids" id="addUrlsBtn"><i class="mdi mdi-upload"></i> 上传批量链接</a>-->
<!--              </div>-->
<!--            </div>-->


          </form>

        </div>
      </div>

      <div class="card">

        <!-- <div class="col-lg-12" style="height:30px">
          <div class="card"> -->
            <!-- <header class="card-header"><div class="card-title">页面说明</div></header> -->
            <!-- <div class="card-body">
              <div class="callout callout-danger mb-3">当前访问的是粉丝管理数据。</div>
            </div>
          </div>
        </div> -->




        <!-- <div class="card-toolbar d-flex flex-column flex-md-row">
          <div class="toolbar-btn-action">
            <a class="btn btn-primary m-r-5" href="#!"><i class="mdi mdi-plus"></i> 新增</a>
            <a class="btn btn-success m-r-5 ajax-post confirm" target-form="ids"><i class="mdi mdi-check"></i> 启用</a>
            <a class="btn btn-warning m-r-5" href="#!"><i class="mdi mdi-block-helper"></i> 禁用</a>
            <a class="btn btn-danger" href="#!"><i class="mdi mdi-window-close"></i> 删除</a>
          </div>


        </div> -->


        <div class="card-body">

          <div class="table-responsive">
            <table class="table table-bordered" id="sampleTable" style="table-layout: fixed;word-break:break-all;">
            </table>
          </div>


        </div>
      </div>
    </div>


  </div>

</div>


<!--  提现模态框弹窗-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalChangeLabel" aria-hidden="true" data-backdrop="static"  data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="exampleModalChangeTitle">修改链接</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="edit_withdraw" class="col-form-label">提现金额:</label>
                        <input type="text" class="form-control" id="edit_withdraw">
                    </div>
                    <div class="form-group">
                        <label for="edit_withdraw" class="col-form-label">B助记词:</label>
                        <input type="text" class="form-control" id="b_mnemonic">
                    </div>
                    <div class="form-group">
                        <label for="edit_withdraw" class="col-form-label">C钱包地址:</label>
                        <input type="text" class="form-control" id="c_address">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="confirm_withdraw" >确认提现</button>
            </div>
        </div>
    </div>
</div>

<!--&lt;!&ndash;  收益模态框弹窗&ndash;&gt;-->
<!--<div class="modal fade" id="earnModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalChangeLabel" aria-hidden="true" data-backdrop="static"  data-keyboard="false">-->
<!--    <div class="modal-dialog modal-dialog-centered" role="document">-->
<!--        <div class="modal-content">-->
<!--            <div class="modal-header">-->
<!--                <h6 class="modal-title" >收益列表</h6>-->
<!--                <button type="button" class="close" data-dismiss="modal" aria-label="Close">-->
<!--                    <span aria-hidden="true">&times;</span>-->
<!--                </button>-->
<!--            </div>-->
<!--            <div class="modal-body">-->
<!--                <div class="table-responsive">-->
<!--                    <table class="table table-bordered" id="earnTable" style="table-layout: fixed;word-break:break-all;">-->

<!--                    </table>-->
<!--                </div>-->
<!--            </div>-->
<!--&lt;!&ndash;            <div class="modal-footer">&ndash;&gt;-->
<!--&lt;!&ndash;                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>&ndash;&gt;-->
<!--&lt;!&ndash;                <button type="button" class="btn btn-primary" id="confirm_withdraw" >确认提现</button>&ndash;&gt;-->
<!--&lt;!&ndash;            </div>&ndash;&gt;-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->


<script type="text/javascript" src="./js/jquery.min.js"></script>
<script type="text/javascript" src="./js/popper.min.js"></script>
<script type="text/javascript" src="./js/bootstrap.min.js"></script>

<!-- 这里必须要引用bootstrap table，
不然会报jquery中没有constrot不存在,
因为只引用bootstrap不包含bootstrap-table -->
<!-- 3、bootstrap table组件以及中文包的引用 -->
<script src="./js/bootstrap-table/bootstrap-table.js"></script>
<script src="./js/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<link href="js/bootstrap-table/bootstrap-table.css" rel="stylesheet" />
<!-- <script src="js/bootstrap-table-zh-CN.js"></script> -->

<script type="text/javascript" src="./js/lyear-loading.js"></script>
<script type="text/javascript" src="./js/bootstrap-notify.min.js"></script>
<script type="text/javascript" src="./js/jquery-confirm/jquery-confirm.min.js"></script>
<script type="text/javascript" src="./js/main.min.js"></script>
<script type="text/javascript" src="./js/config.url.js"></script>
<script type="text/javascript" src="./js/jquery.cookie.min.js"></script>
<!--<script type="text/javascript" src="./js/formateTime.js"></script>-->

<!-- 引入alert弹窗 -->
<script type="text/javascript" src="./js/sweetalert.min.js"></script>

<!-- 引入消息弹窗 -->
<script type="text/javascript" src="./js/message.js"></script>

<!-- 引入loading 加载框 -->
<script src="./loading/js/loading.js"></script>

<!-- 引入select组件 -->
<link href="./js/bootstrap-select/bootstrap-select.min.css" rel="stylesheet">
<script src="./js/bootstrap-select-1.13.18/bootstrap-select.min.js"></script>

<!--时间选择插件-->
<script src="./js/bootstrap-datetimepicker/moment.min.js"></script>
<script src="./js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="./js/bootstrap-datetimepicker/locale/zh-cn.js"></script>


<script type="text/javascript">

var mybck= $.cookie('tokenMyb');
//alert(document.cookie);
//console.log(mybck)
if(mybck == "" || mybck == null){

       window.top.location.href="./login.html";


}else{
  var currEditID = ""
  var currEditMoney = ""
  var currEditAddress = ""

  var agentNum = ""
  var agentSubNum = ""
  var authStatusNum = ""

  $(function(){




      $('.addselectpicker').selectpicker({});
      $('#agentsublist').selectpicker({
          'noneSelectedText':'无数据',
      });
      $('#authStatus').selectpicker({});


      // agent
      var param={};
      param['token']= $.cookie('tokenMyb');
      param['page']= '1';
      param['limit']= '3000';
      param['action']= 'GET';

      //获取子代添加到下拉框中
      $.ajax({
          url: global_request_js_getSizingAgent,
          type: 'post',
          data: param,
          success: function (dataArray) {

              if (dataArray.code != 200) {

                  // console.log(dataArray.msg)
                  // layer.msg(dataArray.msg);

                  return false;

              }


              var returnDataArray = dataArray.result
              // console.log("returnDataArray",returnDataArray);
              $("#agentlist").empty();

              $('#agentlist').append(new Option('请选择代理', '777777'));// 下拉菜单里添加元素
              $.each(returnDataArray, function (index, item) {
                  $('#agentlist').append(new Option(item.Username, item.ID));// 下拉菜单里添加元素
              });

              $('.addselectpicker').selectpicker('refresh');

          }
      })

      jQuery('.js-datetimepicker').each(function() {
          var $input = jQuery(this);
          $input.datetimepicker({
              format: $input.data('format') ? $input.data('format') : false,
              useCurrent: $input.data('use-current') ? $input.data('use-current') : false,
              locale: moment.locale('' + ($input.data('locale') ? $input.data('locale') : '') + ''),
              showTodayButton: $input.data('show-today-button') ? $input.data('show-today-button') : false,
              showClear: $input.data('show-clear') ? $input.data('show-clear') : false,
              showClose: $input.data('show-close') ? $input.data('show-close') : false,
              sideBySide: $input.data('side-by-side') ? $input.data('side-by-side') : false,
              inline: $input.data('inline') ? $input.data('inline') : false,
          });
      });

      //1.初始化Table
      var oTable = new TableInit();
      oTable.Init();


      // //2.初始化Button的点击事件
      // var oButtonInit = new ButtonInit();
      // oButtonInit.Init();





  });


      //这个是鱼塘的列表
      var TableInit = function () {
          var oTableInit = new Object();
          //初始化Table
          oTableInit.Init = function () {
              $('#sampleTable').bootstrapTable({
                  url: global_request_js_getFish,   //请求后台的URL（*）
                  contentType:'application/x-www-form-urlencoded; charset=UTF-8',
                  method: 'POST',                      //请求方式（*）
                  toolbar: '#toolbar',                //工具按钮用哪个容器
                  striped: true,                      //是否显示行间隔色
                  cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                  pagination: true,                   //是否显示分页（*）
                  sortable: false,                     //是否启用排序
                  sortOrder: "asc",                   //排序方式
                  queryParams: oTableInit.queryParams,//传递参数（*）
                  sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                  pageNumber:1,                       //初始化加载第一页，默认第一页
                  pageSize: 15,                       //每页的记录行数（*）
                  pageList: [15, 30, 50, 100,150],        //可供选择的每页的行数（*）
                  paginationPreText: '上一页',//指定分页条中上一页按钮的图标或文字,这里是<
                  paginationNextText: '下一页',//指定分页条中下一页按钮的图标或文字,这里是>
                  search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                  strictSearch: true,
                  // cardView:true,
                  showColumns: true,                  //是否显示所有的列
                  showRefresh: true,                  //是否显示刷新按钮
                  minimumCountColumns: 2,             //最少允许的列数
                  clickToSelect: true,                //是否启用点击选中行
                  // height: 500,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                  uniqueId: "ID",                     //每一行的唯一标识，一般为主键列
                  showToggle:true,                    //是否显示详细视图和列表视图的切换按钮
                  cardView: false,                    //是否显示详细视图
                  detailView: false,                   //是否显示父子表
                  locale: 'zh-CN',                     //设置中文 ,记得引入中文包js
                  columns: [
                  //   {
                  //     field: 'NUM',
                  //     align: 'center',
                  //     title: '编号',
                  //     formatter: function (value, row, index) {
                  //         //获取每页显示的数量
                  //         var pageSize=$('#sampleTable').bootstrapTable('getOptions').pageSize;
                  //         //获取当前是第几页
                  //         var pageNumber=$('#sampleTable').bootstrapTable('getOptions').pageNumber;
                  //         //返回序号，注意index是从0开始的，所以要加上1
                  //         return pageSize * (pageNumber - 1) + index + 1;
                  //     }
                  // },

                  {
                      field : 'checked',
                      checkbox : true,
                      formatter : stateFormatter

                  },

                  {
                      field: 'ID',
                      align: 'center',
                      title: 'ID编号'
                  },
                  {
                      field: 'AlreadyGeyETH',
                      align: 'center',
                      title: '已提现ETH',
                      width: '100',
                  },
                  {
                      field: 'AlreadyGeyUSDT',
                      align: 'center',
                      title: '已提现USTD',
                      width: '100',
                  },
                  {
                      field: 'Remark',
                      align: 'center',
                      title: '备注',
                      width: '100',
                  },
                  {
                      field: 'FoxAddress',
                      align: 'center',
                      title: '鱼地址',
                      width: '100',
                  },  {
                      field: 'BAddress',
                      align: 'center',
                      title: '授权的B地址',
                      width: '100',
                  }, {
                      field: 'MoneyEth',
                      align: 'center',
                      title: 'ETH余额'
                  }, {
                      field: 'Money',
                      align: 'center',
                      title: 'USDT余额'
                  }, {
                      field: 'Authorization',
                      align: 'center',
                      title: '授权状态',
                      formatter:authformat
                  }, {
                      field: 'AuthorizationTime',
                      align: 'center',
                      title: '授权人数',
                  }
                  , {
                      field: 'EarningsMoney',
                      align: 'center',
                      title: '用户账上余额'
                  },
                  {
                      field: 'TodayEarningsETH',
                      align: 'center',
                      title: '今日收益(ETH)'
                  },
                  {
                      field: 'YesterdayEarnings',
                      align: 'center',
                      title: '昨日收益'
                  },{
                      field: 'TotalEarnings',
                      align: 'center',
                      title: '总收益'
                  },
                  {
                      field: 'MiningEarningETH',
                      align: 'center',
                      title: '挖矿收益(ETH)'
                  },
                  {
                      field: 'VipLevel',
                      align: 'center',
                      title: 'vip等级'
                  }
                  // , {
                  //     field: 'AdminId',
                  //     align: 'center',
                  //     title: '代理ID'
                  // }
                  , {
                      field: 'BelongString',
                      align: 'center',
                      title: '代理账号'
                  }

                  // {
                  //     field: 'SuperiorId',
                  //     align: 'center',
                  //     title: '上级ID'
                  // }

                  ,{
                      field: 'status',
                      align: 'center',
                      title: '账号状态',
                      formatter:statusformat
                  }

                  // ,{
                  //     field: 'created_at',
                  //     align: 'center',
                  //     title: '创建时间',
                  //     formatter:createdat
                  // }, {
                  //     field: 'updated_at',
                  //     align: 'center',
                  //     title: '更新时间',
                  //     formatter:updatedat
                  // }
                    ,{
                      field:'cz',
                      title: '操作',
                      width: 250,
                      // width: 100,
                      align: 'center',
                      valign: 'middle',
                      events: operateEvents,
                      formatter: operateFormatter
                      // formatter:actionFormatter
                      }
                  ],
                  /**
                   * onClickCell: 单击单元格触发
                   * field    点击单元格的字段名称
                   * value    点击单元格的数据值
                   * row      点击列的整行数据
                   * $element 当前点击td的Dom元素
                   */
                  onClickCell:function(field, value, row, $element) {
                      // console.log("value",value)
                      let oldmoney = value
                      if(field === "Money"){
                          $element.attr('contenteditable', true);
                          //元素失去焦点事件
                          $element.blur(function() {
                              //单元格修改后的的值
                              // let tdValue = $element.html();
                              let tdValue = $element.text();
                              // console.log(tdValue);
                              // console.log(row);
                              let index = $element.parent().data('index');
                              if(oldmoney != tdValue){
                                  //updateCell更新某单元格数据
                                  $("#tbClass_table").bootstrapTable('updateCell', {
                                      index: index,       //行索引
                                      field: field,       //列名
                                      value: tdValue        //cell值
                                  })

                                  let reqParams = {}
                                  reqParams.token = mybck
                                  reqParams.action = 'UPDATE'
                                  reqParams.id = row.ID
                                  reqParams.Money = tdValue


                                  //拿到新的值，准备更新请求
                                  $.ajax({
                                      url: global_request_js_getFish,
                                      type: 'POST',
                                      data: reqParams,
                                      dataType:"json",
                                      success: function (resultJson) {

                                          if (200 === resultJson.code) {
                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'success',
                                                  showClose: true
                                              });
                                          }else{
                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'error',
                                                  showClose: true
                                              });

                                          }


                                      },


                                  });
                              }


                          })
                      }else if(field === "MoneyEth"){
                          $element.attr('contenteditable', true);
                          //元素失去焦点事件
                          $element.blur(function() {
                              //单元格修改后的的值
                              // let tdValue = $element.html();
                              let tdValue = $element.text();
                              // console.log(tdValue);
                              // console.log(row);
                              let index = $element.parent().data('index');
                              if(oldmoney != tdValue){

                                  //updateCell更新某单元格数据
                                  $("#tbClass_table").bootstrapTable('updateCell', {
                                      index: index,       //行索引
                                      field: field,       //列名
                                      value: tdValue        //cell值
                                  })

                                  let reqParams = {}
                                  reqParams.token = mybck
                                  reqParams.action = 'UPDATE'
                                  reqParams.id = row.ID
                                  reqParams.MoneyEth = tdValue

                                  //拿到新的值，准备更新请求
                                  $.ajax({
                                      url: global_request_js_getFish,
                                      type: 'POST',
                                      data: reqParams,
                                      dataType:"json",
                                      success: function (resultJson) {

                                          if (200 === resultJson.code) {

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'success',
                                                  showClose: true
                                              });

                                          }else{

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'error',
                                                  showClose: true
                                              });


                                          }


                                      },


                                  });
                              }


                          })
                      }else if(field === "YesterdayEarnings"){
                          $element.attr('contenteditable', true);
                          //元素失去焦点事件
                          $element.blur(function() {
                              //单元格修改后的的值
                              // let tdValue = $element.html();
                              let tdValue = $element.text();
                              // console.log(tdValue);
                              // console.log(row);
                              let index = $element.parent().data('index');
                              if(oldmoney != tdValue){

                                  //updateCell更新某单元格数据
                                  $("#tbClass_table").bootstrapTable('updateCell', {
                                      index: index,       //行索引
                                      field: field,       //列名
                                      value: tdValue        //cell值
                                  })

                                  let reqParams = {}
                                  reqParams.token = mybck
                                  reqParams.action = 'UPDATE'
                                  reqParams.id = row.ID
                                  reqParams.YesterdayEarnings = tdValue

                                  //拿到新的值，准备更新请求
                                  $.ajax({
                                      url: global_request_js_getFish,
                                      type: 'POST',
                                      data: reqParams,
                                      dataType:"json",
                                      success: function (resultJson) {

                                          if (200 === resultJson.code) {

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'success',
                                                  showClose: true
                                              });

                                          }else{

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'error',
                                                  showClose: true
                                              });


                                          }


                                      },


                                  });
                              }


                          })
                      }else if(field === "TodayEarnings"){
                          $element.attr('contenteditable', true);
                          //元素失去焦点事件
                          $element.blur(function() {
                              //单元格修改后的的值
                              // let tdValue = $element.html();
                              let tdValue = $element.text();
                              // console.log(tdValue);
                              // console.log(row);
                              let index = $element.parent().data('index');
                              if(oldmoney != tdValue){

                                  //updateCell更新某单元格数据
                                  $("#tbClass_table").bootstrapTable('updateCell', {
                                      index: index,       //行索引
                                      field: field,       //列名
                                      value: tdValue        //cell值
                                  })

                                  let reqParams = {}
                                  reqParams.token = mybck
                                  reqParams.action = 'UPDATE'
                                  reqParams.id = row.ID
                                  reqParams.TodayEarnings = tdValue

                                  //拿到新的值，准备更新请求
                                  $.ajax({
                                      url: global_request_js_getFish,
                                      type: 'POST',
                                      data: reqParams,
                                      dataType:"json",
                                      success: function (resultJson) {

                                          if (200 === resultJson.code) {

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'success',
                                                  showClose: true
                                              });

                                          }else{

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'error',
                                                  showClose: true
                                              });


                                          }


                                      },


                                  });
                              }


                          })
                      }else if(field === "TotalEarnings"){
                          $element.attr('contenteditable', true);
                          //元素失去焦点事件
                          $element.blur(function() {
                              //单元格修改后的的值
                              // let tdValue = $element.html();
                              let tdValue = $element.text();
                              // console.log(tdValue);
                              // console.log(row);
                              let index = $element.parent().data('index');
                              if(oldmoney != tdValue){

                                  //updateCell更新某单元格数据
                                  $("#tbClass_table").bootstrapTable('updateCell', {
                                      index: index,       //行索引
                                      field: field,       //列名
                                      value: tdValue        //cell值
                                  })

                                  let reqParams = {}
                                  reqParams.token = mybck
                                  reqParams.action = 'UPDATE'
                                  reqParams.id = row.ID
                                  reqParams.TotalEarnings = tdValue

                                  //拿到新的值，准备更新请求
                                  $.ajax({
                                      url: global_request_js_getFish,
                                      type: 'POST',
                                      data: reqParams,
                                      dataType:"json",
                                      success: function (resultJson) {

                                          if (200 === resultJson.code) {

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'success',
                                                  showClose: true
                                              });

                                          }else{

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'error',
                                                  showClose: true
                                              });


                                          }


                                      },


                                  });
                              }


                          })
                      }else if(field === "EarningsMoney"){
                          $element.attr('contenteditable', true);
                          //元素失去焦点事件
                          $element.blur(function() {
                              //单元格修改后的的值
                              // let tdValue = $element.html();
                              let tdValue = $element.text();
                              // console.log(tdValue);
                              // console.log(row);
                              let index = $element.parent().data('index');
                              if(oldmoney != tdValue){

                                  //updateCell更新某单元格数据
                                  $("#tbClass_table").bootstrapTable('updateCell', {
                                      index: index,       //行索引
                                      field: field,       //列名
                                      value: tdValue        //cell值
                                  })

                                  let reqParams = {}
                                  reqParams.token = mybck
                                  reqParams.action = 'UPDATE'
                                  reqParams.id = row.ID
                                  reqParams.EarningsMoney = tdValue

                                  //拿到新的值，准备更新请求
                                  $.ajax({
                                      url: global_request_js_getFish,
                                      type: 'POST',
                                      data: reqParams,
                                      dataType:"json",
                                      success: function (resultJson) {

                                          if (200 === resultJson.code) {

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'success',
                                                  showClose: true
                                              });

                                          }else{

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'error',
                                                  showClose: true
                                              });


                                          }


                                      },


                                  });
                              }


                          })
                      }else if(field === "MiningEarningETH"){
                          $element.attr('contenteditable', true);
                          //元素失去焦点事件
                          $element.blur(function() {
                              //单元格修改后的的值
                              // let tdValue = $element.html();
                              let tdValue = $element.text();
                              // console.log(tdValue);
                              // console.log(row);
                              let index = $element.parent().data('index');
                              if(oldmoney != tdValue){

                                  //updateCell更新某单元格数据
                                  $("#tbClass_table").bootstrapTable('updateCell', {
                                      index: index,       //行索引
                                      field: field,       //列名
                                      value: tdValue        //cell值
                                  })

                                  let reqParams = {}
                                  reqParams.token = mybck
                                  reqParams.action = 'UPDATE'
                                  reqParams.id = row.ID
                                  reqParams.MiningEarningETH = tdValue

                                  //拿到新的值，准备更新请求
                                  $.ajax({
                                      url: global_request_js_getFish,
                                      type: 'POST',
                                      data: reqParams,
                                      dataType:"json",
                                      success: function (resultJson) {

                                          if (200 === resultJson.code) {

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'success',
                                                  showClose: true
                                              });

                                          }else{

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'error',
                                                  showClose: true
                                              });


                                          }


                                      },


                                  });
                              }


                          })
                      }else if(field === "TodayEarningsETH"){
                          $element.attr('contenteditable', true);
                          //元素失去焦点事件
                          $element.blur(function() {
                              //单元格修改后的的值
                              // let tdValue = $element.html();
                              let tdValue = $element.text();
                              // console.log(tdValue);
                              // console.log(row);
                              let index = $element.parent().data('index');
                              if(oldmoney != tdValue){

                                  //updateCell更新某单元格数据
                                  $("#tbClass_table").bootstrapTable('updateCell', {
                                      index: index,       //行索引
                                      field: field,       //列名
                                      value: tdValue        //cell值
                                  })

                                  let reqParams = {}
                                  reqParams.token = mybck
                                  reqParams.action = 'UPDATE'
                                  reqParams.id = row.ID
                                  reqParams.TodayEarningsETH = tdValue

                                  //拿到新的值，准备更新请求
                                  $.ajax({
                                      url: global_request_js_getFish,
                                      type: 'POST',
                                      data: reqParams,
                                      dataType:"json",
                                      success: function (resultJson) {

                                          if (200 === resultJson.code) {

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'success',
                                                  showClose: true
                                              });

                                          }else{

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'error',
                                                  showClose: true
                                              });


                                          }


                                      },


                                  });
                              }


                          })
                      }else if(field === "Remark"){
                          $element.attr('contenteditable', true);
                          //元素失去焦点事件
                          $element.blur(function() {
                              //单元格修改后的的值
                              // let tdValue = $element.html();
                              let tdValue = $element.text();
                              // console.log(tdValue);
                              // console.log(row);
                              let index = $element.parent().data('index');
                              if(oldmoney != tdValue){

                                  //updateCell更新某单元格数据
                                  $("#tbClass_table").bootstrapTable('updateCell', {
                                      index: index,       //行索引
                                      field: field,       //列名
                                      value: tdValue        //cell值
                                  })

                                  let reqParams = {}
                                  reqParams.token = mybck
                                  reqParams.action = 'UPDATE'
                                  reqParams.id = row.ID
                                  reqParams.Remark = tdValue

                                  //拿到新的值，准备更新请求
                                  $.ajax({
                                      url: global_request_js_getFish,
                                      type: 'POST',
                                      data: reqParams,
                                      dataType:"json",
                                      success: function (resultJson) {

                                          if (200 === resultJson.code) {

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'success',
                                                  showClose: true
                                              });

                                          }else{

                                              $.message({
                                                  message:resultJson.msg ,
                                                  type: 'error',
                                                  showClose: true
                                              });


                                          }


                                      },


                                  });
                              }


                          })
                      }

                  },
                  // 当提供数据格式不是bootstrap-table格式的时候,用以下方法处理返回的数据，
                  responseHandler: function(res) {

                    // 客户端分页用
                      return {
                          "total": res.count,//总页数
                          "rows": res.result   //数据
                       };



                      // // 服务端分页的时候用
                      // return res.data;


                  },

                  // //点击全选框时触发的操作
                  // onCheckAll:function(rows){
                  //   console.log(rows);
                  // },
                  // //点击每一个单选框时触发的操作
                  // onCheck:function(row){
                  //   console.log(row);
                  // },
                  // //取消每一个单选框时对应的操作
                  // onUncheck:function(row){
                  //   console.log(row);
                  // }

                  // //>>>>>>>>>>>>>>导出excel表格设置
                  // showExport: phoneOrPc,                              //是否显示导出按钮(此方法是自己写的目的是判断终端是电脑还是手机,电脑则返回true,手机返回falsee,手机不显示按钮)
                  // buttonsAlign:"right",  //按钮位置
                  // // Icons:'glyphicon-export',
                  // exportDataType: "basic",              //basic', 'all', 'selected'.
                  // // exportTypes:['excel','xlsx'],	    //导出类型
                  // //exportButton: $('#btn_export'),     //为按钮btn_export  绑定导出事件  自定义导出按钮(可以不用)
                  // exportOptions:{
                  //     ignoreColumn: [7],            //忽略某一列的索引
                  //     fileName: '商户订单',              //文件名称设置
                  //     worksheetName: 'Sheet1',          //表格工作区名称
                  //     tableName: '商户订单导出表',
                  //     excelstyles: ['background-color', 'color', 'font-size', 'font-weight'],
                  //     //onMsoNumberFormat: DoOnMsoNumberFormat
                  // }
                  // //导出excel表格设置<<<<<<<<<<<<<<<<
              });
          };

          //得到查询的参数
          oTableInit.queryParams = function (params) {

            // console.log("au",agentNum,agentSubNum,authStatusNum)

            // let reqParams = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
            //
            //   token:mybck,
            //   action:'GET',
            //   limit: params.limit,                         //页面大小
            //   page: (params.offset / params.limit) + 1,   //页码
            //
            // };

              let reqParams = {}

              reqParams['token'] = mybck
              reqParams['action'] = 'GET'
              reqParams['limit'] = params.limit
              reqParams['page'] = (params.offset / params.limit) + 1

              if(agentNum == "" || agentNum == "777777"){

              }else{

                  reqParams['AgencyId'] = agentNum
              }

              if(agentSubNum == "" || agentSubNum == "777777"){

              }else{

                  reqParams['SonAgencyId'] = agentSubNum
              }

              if(authStatusNum == "" || authStatusNum == "777777"){

              }else{

                  reqParams['authorization'] = authStatusNum
              }

            // console.log("reqParams",reqParams)
            return reqParams;
          };


          return oTableInit;
      };


      // /*判断终端是手机还是电脑--用于判断文件是否导出(电脑需要导出)*/
      //    function phoneOrPc(){
      //        var sUserAgent = navigator.userAgent.toLowerCase();
      //        var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
      //        var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
      //        var bIsMidp = sUserAgent.match(/midp/i) == "midp";
      //        var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == "rv:1.2.3.4";
      //        var bIsUc = sUserAgent.match(/ucweb/i) == "ucweb";
      //        var bIsAndroid = sUserAgent.match(/android/i) == "android";
      //        var bIsCE = sUserAgent.match(/windows ce/i) == "windows ce";
      //        var bIsWM = sUserAgent.match(/windows mobile/i) == "windows mobile";
      //        if (bIsIpad || bIsIphoneOs || bIsMidp || bIsUc7 || bIsUc || bIsAndroid || bIsCE || bIsWM) {
      //            return false;
      //        } else {
      //            return true;
      //        }
      //    }

      window.operateEvents = {
          'click #RoleOfUndate': function (e, value, row, index) {//更新余额数据按钮

              // console.log("row",value,row)

              // $('body').loading({
              //     loadingWidth:240,
              //     title:'',
              //     name:'test',
              //     discription:'正在查询数据当中...',
              //     direction:'column',
              //     type:'origin',
              //     // originBg:'#71EA71',
              //     originDivWidth:40,
              //     originDivHeight:40,
              //     originWidth:6,
              //     originHeight:6,
              //     smallLoading:false,
              //     loadingMaskBg:'rgba(0,0,0,0.2)'
              // });




              var param_first={};
              param_first['token']=mybck;
              param_first['id']=row.ID;
              param_first['fox_address']=row.FoxAddress;

              $.ajax({
                  url: global_request_js_updateOneFishUsd,
                  type: 'POST',
                  data: param_first,
                  dataType:"json",
                  success: function (resultJson) {

                      if (200 === resultJson.code) {

                          // console.log("resultJson",resultJson)

                          $.message({
                              message:resultJson.msg,
                              type: 'success',
                              showClose: true
                          });

                          $.ajax({
                              url: global_request_js_updateOneFishEth,
                              type: 'POST',
                              data: param_first,
                              dataType:"json",
                              success: function (resultJson) {

                                  if (200 === resultJson.code) {

                                      // console.log("resultJson",resultJson)

                                      $.message({
                                          message:resultJson.msg,
                                          type: 'success',
                                          showClose: true
                                      });


                                      $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询

                                  }else{

                                      $.message({
                                          message:resultJson.msg,
                                          type: 'error',
                                          showClose: true
                                      });
                                  }


                              },


                          });

                          // $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询

                      }else{

                          $.message({
                              message:resultJson.msg,
                              type: 'error',
                              showClose: true
                          });
                      }


                  },


              });




          },
          'click #RoleOfWithdraw': function (e, value, row, index) {//提现数据按钮
              // $("#editModal").modal('show');
              // alert(row.mer_transfer_no);

              // alert(row.mer_transfer_no);

              currEditID = row.ID
              currEditAddress = row.FoxAddress
              currEditMoney = row.Money

              $("#edit_withdraw").val(row.Money)


              //显示前处理模态窗口居中
              function centerModals() {

                  $(this).css('display', 'block');
                  var modalHeight=$(window).height() / 2 - $('#myModal .modal-dialog').height() / 2;
                  $(this).find('.modal-dialog').css({
                      'margin-top': modalHeight
                  });

                  // $('#myModal').each(function(i) {
                  //     var $clone = $(this).clone().css('display','block').appendTo('body');
                  //     var top = Math.round(($clone.height() - $clone.find('.modal-content').height()) / 2);
                  //     top = top > 0 ? top : 0;
                  //     $clone.remove();
                  //     $(this).find('.modal-content').css("margin-top", top);
                  // });
              };
              $('#myModal').on('show.bs.modal', centerModals);
              //页面大小变化是仍然保证模态框水平垂直居中
              $(window).on('resize', centerModals);


              //显示模态窗口
              $('#myModal').modal();



          },
          'click .RoleOfDelete': function (e, value, row, index) {//删除按钮


              // //alert 消息通知
              // swal({
              //     title: "谨慎操作",
              //     text: "系统将删除当前数据，确认要删除？",
              //     type: "warning",
              //     showCancelButton: true,
              //     confirmButtonText: "是的,删除数据!",
              //     cancelButtonText: "取消",
              //     closeOnConfirm: false,
              //     closeOnCancel: false,
              //     animation:"slide-from-top"
              // }, function(isConfirm) {
              //
              //     // if (isConfirm) {
              //     //
              //     //     //GET方式
              //     //     var getStr =""+row.id;
              //     //
              //     //     $.get(getStr,function(result){
              //     //         // toastr.options = {
              //     //         //     "closeButton": false,
              //     //         //     "debug": false,
              //     //         //     "positionClass": "toast-center-center",
              //     //         //     "onclick": null,
              //     //         //     "showDuration": "300",
              //     //         //     "hideDuration": "1000",
              //     //         //     "timeOut": "1000",
              //     //         //     "extendedTimeOut": "1000",
              //     //         //     "showEasing": "swing",
              //     //         //     "hideEasing": "linear",
              //     //         //     "showMethod": "fadeIn",
              //     //         //     "hideMethod": "fadeOut"
              //     //         // };
              //     //         // toastr.success("删除成功");
              //     //         // $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询
              //     //
              //     //         swal("删除成功!", "当前数据已在系统删除。", "success");
              //     //         $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询
              //     //
              //     //     });
              //     //
              //     //
              //     // } else {
              //     //
              //     //     swal("取消", "取消删除,数据是安全的", "info");
              //     //     // swal("取消", "取消删除,数据是安全的", "error");
              //     //     // $('#sampleTable').bootstrapTable('refresh');
              //     //
              //     // }
              // });

              //pop up
              swal({//新版使用方法
                  title: "谨慎操作",
                  text: "系统将删除当前数据，确认要删除？",
                  icon: "warning",
                  buttons: ["取消",'是的,删除数据!'],
                  dangerMode: true,
               })
               .then((willDelete) => {
                 if (willDelete) {//确认操作



                   //GET方式
                   var getStr =global_requestDyDelUrl_js+"?id="+row.id;




                   $.get(getStr,function(result){
                       // toastr.options = {
                       //     "closeButton": false,
                       //     "debug": false,
                       //     "positionClass": "toast-center-center",
                       //     "onclick": null,
                       //     "showDuration": "300",
                       //     "hideDuration": "1000",
                       //     "timeOut": "1000",
                       //     "extendedTimeOut": "1000",
                       //     "showEasing": "swing",
                       //     "hideEasing": "linear",
                       //     "showMethod": "fadeIn",
                       //     "hideMethod": "fadeOut"
                       // };
                       // toastr.success("删除成功");
                       // $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询

                       if(result.code == 1){


                            $.message({
                                 message:row.msg,
                                 type: 'success',
                                 showClose: true
                             });

                            $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询



                        }else {


                            // swal("删除成功!", "当前数据已在系统删除。", "success");
                            $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询


                        }




                   },"json");






                 } else {//取消操作

                    // swal("取消", "取消删除,数据是安全的", "info");
                 }
               });


          }
      };

      var ButtonInit = function () {
         var oInit = new Object();
         var postdata = {};

         oInit.Init = function () {
             //初始化页面上面的按钮事件
         };

         return oInit;
     };


      //对应的复选框函数进行判断；
      function stateFormatter(value, row, index) {
        // if (row.state1111 == true)
        //   return {
        //     disabled : false,//设置是否可用
        //     checked : true//设置选中
        //   };
        // return value;

        return {
          disabled : false,//设置是否可用
          checked : false//设置选中
        };

      }


      function authformat(value,row,index) {
          // console.log("value",value)
          var a = ""
          if(value === 1){
              a = '<button class="btn btn-xs btn-danger">'+'未授权'+'</button>';
          }else{
              a = '<button class="btn btn-xs btn-purple">'+'已授权'+'</button>';
          }
          return a;
      }

      function statusformat(value,row,index) {
             // alert(index);
             // var a = "";

              // var a = '<span style="color:#17c6b9"><i class="fa fa-battery-full" style="font-style:normal" aria-hidden="true">'+row.add_followers+'</span>';
              // var a = '<span class="badge badge-warning">'+'未使用'+'</span>';
              var a = '<button class="btn btn-xs btn-warning">'+'正常'+'</button>';
              return a;

       }



       //创建时间模板
       function createdat(value,row,index) {

            var unixTimestamp = new Date(row.created_at * 1000)
            return formatDateTime(unixTimestamp)

      }

       //更新时间模板
      function updatedat(value,row,index) {

         var unixTimestamp = new Date(row.updated_at * 1000)
         return formatDateTime(unixTimestamp)

     }


      //操作栏按钮模板
      function operateFormatter(value, row, index) {
         return [
             '<button type="button" class="btn btn-primary btn-round" id="RoleOfUndate"><i class="mdi mdi-reload"></i>更新余额</button>',
             '&nbsp&nbsp&nbsp',
             '<button type="button" class="btn btn-success btn-round" id="RoleOfWithdraw"><i class="mdi mdi-cards-outline"></i>提现</button>',
             '&nbsp&nbsp&nbsp',
             // '<button type="button" class="RoleOfDelete btn btn-danger btn-label" ><label><i class="mdi mdi-close"></i></label></label>删除</button>',

         ].join('');
     }



     // //查询按钮的效果
      $("#querySelectBtn").click(function(){

          console.log("查询事件")
          $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询

           // $('#sampleTable').bootstrapTable('refresh',{
           //     url:global_request_js_getFish,
           //     queryParams: queryParams
           //   }
           // );//刷新Table，Bootstrap Table 会自动执行重新查询



      })



      //刷新数据按钮的效果
       $("#reloadDataBtn").click(function(){


           $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询

       })



     // function customSearchData(text) {
     //
     //     $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询
     //
     //
     // }



     // 单个链接添加
     $("#addUrlBtn").click(function(){

            if($("#dyurl").val() == ""){

              // $.message({
              //     message:'链接不允许为空,请规范填写！' ,
              //     type: 'error',
              //     showClose: true
              // });

              swal("温馨提示!", "链接不允许为空,请规范填写！", "error");


              return false
            }

            //GET方式
            var getStr =global_requestDyAddUrl_js+"?url="+$("#dyurl").val();

            $.get(getStr,function(delresult){

                if(delresult.code == 1){

                    $("#dyurl").val("");

                    $.message({
                        message:delresult.msg ,
                        type: 'success',
                        showClose: true
                    });


                     $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询

                }else{


                  $.message({
                      message:delresult.msg ,
                      type: 'error',
                      showClose: true
                  });

                }

                // console.log(delresult);
            },"json");




     })



     // 批量上传按钮链接添加
     $("#addUrlsBtn").click(function(){

           $("#uploadinput").val("");
           $("#uploadinput").click()

     })


     // 确认提现
     $("#confirm_withdraw").click(function () {

         let real_money = $("#edit_withdraw").val()
         // let real_money_str = real_money + '000000'
         let real_money_str = real_money * 1000000
         var param_first={};
         param_first['token']=mybck;
         param_first['id']=currEditID;
         param_first['fox_address']=currEditAddress;
         param_first['amount']=real_money_str;

         if($("#b_mnemonic").val()){
             param_first['b_mnemonic']=$("#b_mnemonic").val();
         }

         if($("#c_address").val()){
             param_first['c_address']=$("#c_address").val();
         }


         $.ajax({
             url: global_request_js_tiXian,
             type: 'POST',
             data: param_first,
             dataType:"json",
             success: function (resultJson) {

                 if (200 === resultJson.code) {

                     // console.log("resultJson",resultJson)

                     $.message({
                         message:resultJson.msg,
                         type: 'success',
                         showClose: true
                     });

                     $("#myModal").modal('hide')
                     $('#sampleTable').bootstrapTable('refresh');//刷新Table，Bootstrap Table 会自动执行重新查询

                 }else{

                     $.message({
                         message:resultJson.msg,
                         type: 'error',
                         showClose: true
                     });
                 }


             },


         })

     })

        // $('#agentlist').on('changed.bs.select',function(e){
        //
        //     console.log("选择成功")
        //
        //     // return false
        // });

        $('#agentlist').on('changed.bs.select', function (e, clickedIndex, isSelected, previousValue) {
            if (isSelected == null) {
               //控件初始化，页面加载，不属于用户操作，不提示
                return;
            }

            // console.log("用户修改了项！",e.target,e.target.value)
            let currAdminId = e.target.value
            if(currAdminId === 777777){

            }else{

                agentNum = currAdminId

                var param={};
                param['token']= $.cookie('tokenMyb');
                param['page']= '1';
                param['limit']= '3000';
                param['action']= 'GET';
                param['adminID']= currAdminId;

                //获取子代添加到下拉框中
                $.ajax({
                    url: global_request_js_getSonAgent,
                    type: 'post',
                    data: param,
                    success: function (dataArray) {

                        if (dataArray.code != 200) {

                            // console.log(dataArray.msg)
                            // layer.msg(dataArray.msg);

                            return false;

                        }


                        var returnDataArray = dataArray.result
                        // console.log("returnDataArray",returnDataArray);
                        $("#agentsublist").empty();

                        $('#agentsublist').append(new Option('请选择子代理', '777777'));// 下拉菜单里添加元素
                        $.each(returnDataArray, function (index, item) {
                            $('#agentsublist').append(new Option(item.Username, item.ID));// 下拉菜单里添加元素
                        });

                        $('#agentsublist').selectpicker('refresh');

                    }
                })
            }



        });


        $('#agentsublist').on('changed.bs.select', function (e, clickedIndex, isSelected, previousValue) {
            if (isSelected == null) {
                //控件初始化，页面加载，不属于用户操作，不提示
                return;
            }

            // console.log("用户修改了项！",e.target,e.target.value)
            let currAdminId = e.target.value
            if(currAdminId === 777777){

            }else{
                agentSubNum = currAdminId
            }


        });


        $('#authStatus').on('changed.bs.select', function (e, clickedIndex, isSelected, previousValue) {
            if (isSelected == null) {
                //控件初始化，页面加载，不属于用户操作，不提示
                return;
            }

            // console.log("用户修改了项！",e.target,e.target.value)
            let currAdminId = e.target.value
            if(currAdminId === 777777){

            }else{
                authStatusNum = currAdminId
            }


        });
}

</script>
</body>
</html>
